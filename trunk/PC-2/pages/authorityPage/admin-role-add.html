<!DOCTYPE HTML>
<html>
<head>
<meta charset="utf-8">
<meta name="renderer" content="webkit|ie-comp|ie-stand">
<meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
<meta name="viewport" content="width=device-width,initial-scale=1,minimum-scale=1.0,maximum-scale=1.0,user-scalable=no" />
<meta http-equiv="Cache-Control" content="no-siteapp" />
<!--[if lt IE 9]>
<script type="text/javascript" src="lib/html5.js"></script>
<script type="text/javascript" src="lib/respond.min.js"></script>
<script type="text/javascript" src="lib/PIE_IE678.js"></script>
<![endif]-->
<link href="../../css/H-ui.min.css" rel="stylesheet" type="text/css" />
<link href="../../css/H-ui.admin.css" rel="stylesheet" type="text/css" />
<link href="../../css/style.css" rel="stylesheet" type="text/css" />
<link href="../../lib/Hui-iconfont/1.0.1/iconfont.css" rel="stylesheet" type="text/css" />
<!--[if IE 6]>
<script type="text/javascript" src="lib/DD_belatedPNG_0.0.8a-min.js" ></script>
<script>DD_belatedPNG.fix('*');</script>
<![endif]-->
<title>新建网站角色</title>
</head>
<body>
<div class="pd-20">
	<div class="form form-horizontal" id="form-user-character-add">
		<div class="row cl">
			<label class="form-label col-3"><span class="c-red">*</span>角色名称：</label>
			<div class="formControls col-7">
				<input type="text" class="input-text" value="" placeholder="" id="role-name" name="mustInput" datatype="*" nullmsg="角色名称不能为空">
			</div>
			<div class="col-2"> </div>
		</div>
		<div class="row cl">
			<label class="form-label col-3">角色说明：</label>
			<div class="formControls col-7">
				<textarea class="textarea" id="role-detail"></textarea>
			</div>
		</div>
		<div class="row cl">
			<label class="form-label col-3"><span class="c-red">*</span>所属公司：</label>
			<!--总部超级管理员，出现现在的html样式，即可多选多个公司，公司多少的数据来源接口返回
			 分部的超管或拥有角色管理权限的员工，此部分该显示为员工当前公司--（当前公司已在登录的时候存入cookie）
			-->
			<div class="formControls col-7" >
				<dl class="permission-list" id="role-company">
					<dt>
						<label>
							<input type="checkbox" value="" name="CompanyBelong-0" id="CompanyBelong-0">
							全部</label>
					</dt>
					<dd>
						<dl class="cl permission-list2" name="mustInput">
							<dt>
								<label class="">
									<input type="checkbox" value="" name="CompanyBelong-0-0" id="CompanyBelong-0-0">
									广州分公司
								</label>
							</dt>
							<dt>
								<label class="">
									<input type="checkbox" value="" name="CompanyBelong-0-1" id="CompanyBelong-0-1">
									深圳分公司
								</label>
							</dt>
						</dl>
						
					</dd>
				</dl>
				
			</div>
		</div>
		<div class="row cl">
			<label class="form-label col-3"><span class="c-red">*</span>角色状态：</label>
			<div class="formControls col-7">
				<span class="select-box"  >
				    <select class="select" id="role-status" size="1" name="mustInput" datatype="*" nullmsg="请选择角色状态">
					    <option value="" selected>默认select</option>
					    <option value="0">禁用</option>
					    <option value="1">启用</option>
				    </select>
				</span>
			</div>
			<div class="col-2"></div>
		</div>
		<div class="row cl">
			<label class="form-label col-3">角色权限：</label>
			<div class="formControls col-7">
				<dl class="permission-list" id="role-limits">
					<dt>
						<label>
							<input type="checkbox" value="" name="user-Character-0" id="allAuthority">
							全部</label>
					</dt>
					<dd>
						<dl class="cl permission-list2">
							<dt>
								<label class="">
									<input type="checkbox" value="" name="user-Character-0-0" id="0">
									权限管理
								</label>
							</dt>
							<!--<dt>
								<label class="">
									<input type="checkbox" value="" name="user-Character-0-1" id="1">
									公司维护</label>
							</dt>
							<dt>
								<label class="">
									<input type="checkbox" value="" name="user-Character-0-1" id="2">
									粉丝管理</label>
							</dt>
							<dt>
								<label class="">
									<input type="checkbox" value="" name="user-Character-0-1" id="3">
									我要推荐</label>
							</dt>
							<dt>
								<label class="">
									<input type="checkbox" value="" name="user-Character-0-1" id="4">
									客户服务</label>
							</dt>
							<dt>
								<label class="">
									<input type="checkbox" value="" name="user-Character-0-1" id="5">
									客户中心</label>
							</dt>
							<dt>
								<label class="">
									<input type="checkbox" value="" name="user-Character-0-1" id="6">
									修改密码</label>
							</dt>
							<dt>
								<label class="">
									<input type="checkbox" value="" name="user-Character-0-1" id="7">
									统计分析</label>
							</dt>-->
						</dl>
						
					</dd>
				</dl>
				
			</div>
		</div>
		<div class="row cl">
			<div class="col-10 col-offset-2 ">
				<button type="button" class="btn btn-primary radius" id="admin-role-save" name="admin-role-save"><i class="icon-ok"></i> 确定</button>
				<button type="button" class="btn btn-danger radius" id="admin-role-cansel" onclick="layer_close();"><i class="icon-ok"></i> 取消</button>
			</div>
		</div>
	</div>
</div>
<script type="text/javascript" src="../../lib/jquery/1.9.1/jquery.min.js"></script> 
<script type="text/javascript" src="../../lib/layer/1.9.3/layer.js"></script> 
<script type="text/javascript" src="../../lib/My97DatePicker/WdatePicker.js"></script> 
<script type="text/javascript" src="../../lib/Validform/5.3.2/Validform.min.js"></script> 
<script type="text/javascript" src="../../js/H-ui.js"></script> 
<script type="text/javascript" src="../../js/H-ui.admin.js"></script> 
<script type="text/javascript" src="../../js/selfscript.js" ></script>
<script>
var companyId,pageType;
var myDate=new Date().format('yyyy-MM-dd');//当前日期
$(function(){
	getA();
	/*获取roleID*/
	var roleId=getCookie("RoleId");
	/*获取pagecookie值：1.添加，2.编辑，3.查看*/
	companyId=getCookie("companyId");//公司类型
	pageType=getCookie("PAGETYPE");//页面类型
	if(pageType=="1"){
		//添加
	}else if(pageType=="2"){
		//编辑
		getRolesDetail(roleId);
		
	}else if(pageType=="3"){
		//查看
		//获取角色详情
		getRolesDetail(roleId);
	}
	
	$(".permission-list dt input:checkbox").click(function(){
		$(this).closest("dl").find("dd input:checkbox").prop("checked",$(this).prop("checked"));
	});
	$(".permission-list2 dd input:checkbox").click(function(){
		var l =$(this).parent().parent().find("input:checked").length;
		var l2=$(this).parents(".permission-list").find(".permission-list2 dd").find("input:checked").length;
		if($(this).prop("checked")){
			$(this).closest("dl").find("dt input:checkbox").prop("checked",true);
			$(this).parents(".permission-list").find("dt").first().find("input:checkbox").prop("checked",true);
		}
		else{
			if(l==0){
				$(this).closest("dl").find("dt input:checkbox").prop("checked",false);
			}
			if(l2==0){
				$(this).parents(".permission-list").find("dt").first().find("input:checkbox").prop("checked",false);
			}
		}
		
	});
	$("#form-user-character-add").Validform({
		tiptype:2,
		callback:function(form){
			form[0].submit();
			var index = parent.layer.getFrameIndex(window.name);
			parent.$('.btn-refresh').click();
			parent.layer.close(index);
		}
	});
});
	
//	console.log(JSON.stringify(rolesAuthority));
	var url_getList=URLHEAD+"rolesType";//获取角色地址头部定义
	/*查看详情*/
	function getRolesDetail(rid){
		$.ajax({
			type:"get",
			url:url_getList+"?type=2",
			dataType:'json',
			success:function(data){
				for(var i=0;i<data.data.length;i++){
					if(data.data[i].rolesId==rid){
						var datalist=data.data[i];
						insertIntoList(datalist);
					}
				}
				
			},
			error:function(err){
				alert(JSON.stringify(err));
				return;
			}
		});
	}
	
	var cAcount;//创建人
	function insertIntoList(data){
		console.log(JSON.stringify(data));
		cAcount=data.createAcount;
		$("#role-name").val(data.rolesName);
		$("#role-detail").text(data.rolesMsg);
		var param=document.getElementById("role-status").options;
		for(var i=0;i<$("#role-status option").length;i++){
			if(param[i].value==data.rolesStatus){
				param[i].selected=true;
			}
		}
//		rolesMenu?角色权限解释
	}
    
    $("#admin-role-save").click(function(){
			validEdit();
	})
	function validEdit(){
		/*验证输入框*/
		var oMust=document.getElementsByName('mustInput'),flag=0;
//		alert(oMust.length);
		for(var i=0;i<oMust.length;i++){
			if(oMust[i].value!=""){
				flag++;
			}else {
				layer.msg('请确认必填项已填完整!',{icon:0,time:1000});
				$("*[name='mustInput']").addClass("Validform_error");
				return;
			}
		}
		if(flag==oMust.length){
			if(pageType=="1"){
				//添加
				submitAdd();
			}else if(pageType=="2"){
				//编辑
				submitEdit();
			}
		}
	}
	
	/*获取权限*/
	var oRmenu=[],oRmenu_str="",aRoot="";
	function getA(){
	 //获取权限列表
		var iHtml_root="",iHtml_comp="";
		for(var i=0;i<rolesAuthority.length;i++){
			aRoot+=rolesAuthority[i].id;
			
			iHtml_root+='<dt><label class="">'
				 +'<input type="checkbox" value="" name="user-Character-0-0" id="'+i+'" onclick="getAuthority('+this.id+')"/>'+rolesAuthority[i].name+'</label></dt>'
				 //所属公司
//			iHtml_comp+='<dt><label class="">'
//				 +'<input type="checkbox" value="" name="user-Character-0-0" id="'+i+'"/>'+rolesAuthority[i].name+'</label></dt>'
		}
		$("#role-limits dl").html(iHtml_root);
//		$("#role-company dl").html(iHtml_comp);
		$("#allAuthority").click(function(){
			//getAuthority(aRoot);
		})
	}
	function getAuthority(root){
		//获取权限id，传送后台
		oRmenu_str="("+root+")";
//		oRmenu_str+=''
	}
	
	/*
	 <dl class="cl permission-list2">
							<dt>
								<label class="">
									<input type="checkbox" value="" name="user-Character-0-0" id="0">
									权限管理
								</label>
							</dt>*/
	
	
	
	
	
	
	
	/*提交编辑操作*/
	function submitEdit(){
		var dataEdit={
			"rolesName":$("#role-name").val(),
			"rolesMsg":$("#role-detail").text(),
			"rolesId":roleId,
			"createAcount":cAcount,
//			"rolesStatus":,
		};
	   $.ajax({
	   	 url:url_getList+"?type=3",
	   	 data:dataEdit,
	   	 dataType:'json',
	   	 type:'post',
	   	 success:function(data){
	   	 	console.log("编辑："+JSON.stringify(data));
	   	 },
	   	 error:function(err){
	   	 	alert(JSON.stringify(err));
	   	 }
	   })
	}
	/*提交新增*/
	function submitAdd(){
		var dataAdd={
//			'rolesName':,
//			'rolesCompany':,
//			'companyId':,
//			'rolesMsg':,
//			'rolesStatus':,
//			'createAcount':,
		};
		$.ajax({
	   	 url:url_getList+"?type=1",
	   	 data:dataAdd,
	   	 dataType:'json',
	   	 type:'post',
	   	 success:function(data){
	   	 	console.log("新增："+JSON.stringify(data));
	   	 },
	   	 error:function(err){
	   	 	alert(JSON.stringify(err));
	   	 }
	   })
	}
	
	
	
</script>
</body>
</html>